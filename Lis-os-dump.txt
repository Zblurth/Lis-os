{"_meta":{"date":"2025-12-04","note":"Format: JSONL (Lines of JSON). p=path, c=content","os":"NixOS-Unstable","wm":"Niri"},"protocol":["1. ANALYZE REQUEST","2. DISCUSS STRATEGY (WHY/HOW)","3. IMPLEMENT"],"rules":{"cmds":{"rebuild":"fr","update":"up-os"},"imports":"Explicit defaults only.","safety":"NO sed. Use cat <<EOF to OVERWRITE files.","structure":{"cli":"modules/core/packages.nix","gui":"modules/home/packages.nix","sys":"modules/core/*","user":"modules/home/*"}}}
{"p":".gitignore","c":"result\nresult-*\n*.xml\nrepomix-output.txt\n.zed/\n*.swp\n.bash_history\n.zsh_history\n*.qcow2"}
{"p":"flake.nix","c":"{\n  description = \"Lis-os\";\n  inputs = {\n      nixpkgs.url = \"github:nixos/nixpkgs/nixos-unstable\";\n      home-manager = {\n        url = \"github:nix-community/home-manager\";\n        inputs.nixpkgs.follows = \"nixpkgs\";\n      };\n      stylix = {\n        url = \"github:danth/stylix\";\n        inputs.nixpkgs.follows = \"nixpkgs\";\n      };\n      noctalia = {\n        url = \"github:noctalia-dev/noctalia-shell\";\n        inputs.nixpkgs.follows = \"nixpkgs\";\n      };\n    };\n  outputs =\n    { nixpkgs, flake-utils, ... }@inputs:\n    let\n      system = \"x86_64-linux\";\n      mkHost =\n        {\n          hostname,\n          profile,\n          username,\n        }:\n        nixpkgs.lib.nixosSystem {\n          inherit system;\n          specialArgs = {\n            inherit inputs;\n            host = hostname;\n            inherit profile;\n            inherit username;\n          };\n          modules = [\n            ./hosts/default.nix\n          ];\n        };\n    in\n    {\n      nixosConfigurations = {\n        nixos = mkHost {\n          hostname = \"nixos\";\n          profile = \"amd\";\n          username = \"lune\";\n        };\n      };\n    };\n}"}
{"p":"hosts/default.nix","c":"{ pkgs, inputs, ... }: # <--- 1. ADD 'inputs' HERE\n{\n  imports = [\n    inputs.stylix.nixosModules.stylix # <--- 2. ADD THIS LINE (Loads the Stylix software)\n    ./hardware.nix\n    ../modules/core/boot.nix\n    ../modules/core/hardware.nix\n    ../modules/core/drivers.nix\n    ../modules/core/system.nix\n    ../modules/core/user.nix\n    ../modules/core/security.nix\n    ../modules/core/network.nix\n    ../modules/core/services.nix\n    ../modules/core/packages.nix\n    ../modules/core/portals.nix\n    ../modules/core/fonts.nix\n    ../modules/core/appimage.nix\n    ../modules/core/greetd.nix\n    ../modules/core/stylix.nix\n    ../modules/core/nh.nix\n    ../modules/core/steam.nix\n  ];\n  programs.niri.package = pkgs.niri;\n}"}
{"p":"hosts/hardware.nix","c":"{\n  config,\n  lib,\n  modulesPath,\n  ...\n}:\n{\n  imports = [\n    (modulesPath + \"/installer/scan/not-detected.nix\")\n  ];\n  boot.initrd.availableKernelModules = [\n    \"nvme\"\n    \"xhci_pci\"\n    \"ahci\"\n    \"usbhid\"\n  ];\n  boot.initrd.kernelModules = [ ];\n  boot.kernelModules = [ \"kvm-amd\" ];\n  boot.extraModulePackages = [ ];\n  fileSystems.\"/\" = {\n    device = \"/dev/disk/by-uuid/ee1fa0da-4a03-4f83-954c-e48b611d8c9d\";\n    fsType = \"ext4\";\n  };\n  fileSystems.\"/boot\" = {\n    device = \"/dev/disk/by-uuid/2B64-B786\";\n    fsType = \"vfat\";\n    options = [\n      \"fmask=0077\"\n      \"dmask=0077\"\n    ];\n  };\n  swapDevices = [\n    { device = \"/dev/disk/by-uuid/c86b46d7-91a9-410e-bfc4-375bf511f7fa\"; }\n  ];\n  networking.useDHCP = lib.mkDefault true;\n  nixpkgs.hostPlatform = lib.mkDefault \"x86_64-linux\";\n  hardware.cpu.amd.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;\n}"}
{"p":"hosts/variables.nix","c":"{\n  gitUsername = \"lune\";\n  gitEmail = \"lune@nixos\";\n  timeZone = \"Europe/Paris\";\n  monitorConfig = ''\n    output \"DP-2\" {\n        mode \"3440x1440@100.000\"\n        scale 1.0\n        position x=0 y=0\n    }\n  '';\n  clock24h = false;\n  browser = \"vivaldi\";\n  terminal = \"kitty\";\n  keyboardLayout = \"us\";\n  consoleKeyMap = \"us\";\n  thunarEnable = true;\n  stylixEnable = true;\n  barChoice = \"noctalia\";\n  defaultShell = \"zsh\";\n  stylixImage = ../wallpapers/Valley.jpg;\n  startupApps = [ ];\n}"}
{"p":"modules/core/appimage.nix","c":"{ pkgs, ... }:\n{\n  boot.binfmt.registrations.appimage = {\n    wrapInterpreterInShell = false;\n    interpreter = \"${pkgs.appimage-run}/bin/appimage-run\";\n    recognitionType = \"magic\";\n    offset = 0;\n    mask = ''\\xff\\xff\\xff\\xff\\x00\\x00\\x00\\x00\\xff\\xff\\xff'';\n    magicOrExtension = ''\\x7fELF....AI\\x02'';\n  };\n  environment.systemPackages = [ pkgs.appimage-run ];\n  programs.fuse.userAllowOther = true;\n}"}
{"p":"modules/core/boot.nix","c":"{ pkgs, ... }:\n{\n  boot = {\n    kernelPackages = pkgs.linuxPackages;\n    loader.systemd-boot.enable = true;\n    loader.efi.canTouchEfiVariables = true;\n    plymouth.enable = true;\n  };\n}"}
{"p":"modules/core/drivers.nix","c":"{ pkgs, config, ... }:\n{\n  hardware.graphics = {\n    enable = true;\n    enable32Bit = true;\n  };\n  services.xserver.videoDrivers = [ \"amdgpu\" ];\n  systemd.tmpfiles.rules = [\n    \"L+    /opt/rocm/hip   -    -    -     -    ${pkgs.rocmPackages.clr}\"\n  ];\n  boot.kernelModules = [\n    \"it87\"\n    \"v4l2loopback\"\n  ];\n  boot.extraModulePackages = [\n    config.boot.kernelPackages.v4l2loopback\n    config.boot.kernelPackages.it87\n  ];\n  programs.coolercontrol.enable = true;\n   programs.corectrl.enable = true; # Disabled for stability\n   hardware.amdgpu.overdrive = {\n     enable = true;\n     ppfeaturemask = \"0xffffffff\";\n   };\n}"}
{"p":"modules/core/fonts.nix","c":"{ pkgs, ... }: {\n  fonts = {\n    fontconfig = {\n      enable = true;\n      defaultFonts = {\n        serif = [ \"Jost\" \"Noto Serif\" \"Noto Serif CJK SC\" ];\n        sansSerif = [ \"Jost\" \"Noto Sans\" \"Noto Sans CJK SC\" ];\n        monospace = [ \"JetBrains Mono\" \"Noto Sans Mono CJK SC\" ];\n      };\n    };\n    packages = with pkgs; [\n      jost  # Your main font\n      jetbrains-mono  # Terminal/code\n      noto-fonts\n      noto-fonts-cjk-sans\n      noto-fonts-cjk-serif\n      noto-fonts-color-emoji\n      font-awesome\n    ];\n  };\n}"}
{"p":"modules/core/greetd.nix","c":"{ pkgs, ... }:\n{\n  services.greetd = {\n    enable = true;\n    settings = {\n      default_session = {\n        command = \"${pkgs.tuigreet}/bin/tuigreet --time --remember --cmd niri-session\";\n        user = \"greeter\";\n      };\n    };\n  };\n  security.pam.services.greetd.enableGnomeKeyring = true;\n  environment.systemPackages = [ pkgs.tuigreet ];\n}"}
{"p":"modules/core/hardware.nix","c":"{ pkgs, config, ... }:\n{\n  hardware = {\n    sane = {\n      enable = true;\n      extraBackends = [ pkgs.sane-airscan ];\n      disabledDefaultBackends = [ \"escl\" ];\n    };\n    graphics.enable = true;\n    enableRedistributableFirmware = true;\n    bluetooth.enable = true;\n    bluetooth.powerOnBoot = true;\n    i2c.enable = true;\n  };\n  boot.extraModulePackages = [ config.boot.kernelPackages.ddcci-driver ];\n  boot.kernelModules = [ \"i2c-dev\" \"ddcci_backlight\" ];\n  services.udev.extraRules = ''\n    KERNEL==\"i2c-[0-9]*\", GROUP=\"i2c\", MODE=\"0660\"\n    SUBSYSTEM==\"i2c\", ACTION==\"add\", ATTR{name}==\"AMDGPU DM*\", RUN+=\"${pkgs.bash}/bin/sh -c 'echo ddcci 0x37 > /sys/bus/i2c/devices/%k/new_device'\"\n  '';\n}"}
{"p":"modules/core/network.nix","c":"{\n  host,\n  options,\n  ...\n}: {\n  networking = {\n    hostName = \"${host}\";\n    networkmanager.enable = true;\n    timeServers = options.networking.timeServers.default ++ [\"pool.ntp.org\"];\n    firewall = {\n      enable = true;\n      allowedTCPPorts = [\n        22\n        80\n        443\n        59010\n        59011\n        8080\n      ];\n      allowedUDPPorts = [\n        59010\n        59011\n      ];\n    };\n  };\n}"}
{"p":"modules/core/nh.nix","c":"{ pkgs, username, ... }:\n{\n  programs.nh = {\n    enable = true;\n    clean = {\n      enable = true;\n      extraArgs = \"--keep-since 7d --keep 5\";\n    };\n    flake = \"/home/${username}/Lis-os\";\n  };\n  environment.variables.FLAKE = \"/home/${username}/Lis-os\";\n  environment.systemPackages = with pkgs; [\n    nix-output-monitor\n    nvd\n  ];\n}"}
{"p":"modules/core/packages.nix","c":"{ pkgs, ... }:\n{\n  nixpkgs.config.allowUnfree = true;\n  environment.systemPackages = with pkgs; [\n    git         # Version control\n    wget curl   # Network fetchers\n    unzip unrar # Archive handlers\n    nixd        # Nix Language Server\n    nil         # Alternative Nix LSP (for Zed)\n    nixfmt-rfc-style  # Formatter\n    nix-output-monitor # Better nix output\n    nvd         # Diff between generations\n    lm_sensors  # Temperature monitoring\n    pciutils    # lspci\n    usbutils    # lsusb\n    lshw        # Hardware lister\n    htop        # Interactive process viewer\n    btop        # Modern resource monitor (colorful!)\n    iotop       # Disk I/O monitoring\n    duf         # Better df alternative\n    ncdu        # Disk usage analyzer (TUI)\n    smartmontools # SMART disk monitoring\n    nmap        # Network scanner\n    iperf3      # Network performance testing\n    ethtool     # Ethernet interface config\n    wireshark   # Packet analyzer (GUI)\n    ripgrep     # Better grep\n    fd          # Better find\n    eza         # Better ls\n    bat         # Better cat (syntax highlighting)\n    fzf         # Fuzzy finder\n    file        # Determine file type\n    tree        # Directory tree view\n    rsync       # File synchronization\n    ffmpeg      # Video/audio processing\n    pipewire    # Audio server\n    wireplumber # Session manager\n  ];\n}"}
{"p":"modules/core/portals.nix","c":"{ pkgs, ... }:\n{\n  xdg.portal = {\n    enable = true;\n    wlr.enable = false; # Niri uses GNOME portal, not WLR\n    xdgOpenUsePortal = true; # Force apps to use the portal for links/files\n    extraPortals = [\n      pkgs.xdg-desktop-portal-gtk\n      pkgs.xdg-desktop-portal-gnome\n    ];\n    config = {\n      niri = {\n        default = [ \"gtk\" ]; # Use GTK for file pickers (fast)\n        \"org.freedesktop.impl.portal.ScreenCast\" = [ \"gnome\" ]; # Discord Streaming\n        \"org.freedesktop.impl.portal.Screenshot\" = [ \"gnome\" ];\n        \"org.freedesktop.impl.portal.Secret\" = [ \"gnome-keyring\" ]; # Passwords\n      };\n      common = {\n        default = [ \"gtk\" ];\n        \"org.freedesktop.impl.portal.ScreenCast\" = [ \"gnome\" ];\n        \"org.freedesktop.impl.portal.Screenshot\" = [ \"gnome\" ];\n        \"org.freedesktop.impl.portal.Secret\" = [ \"gnome-keyring\" ];\n      };\n    };\n  };\n}"}
{"p":"modules/core/security.nix","c":"_: {\n  security = {\n    rtkit.enable = true;\n    polkit = {\n      enable = true;\n      extraConfig = ''\n        polkit.addRule(function(action, subject) {\n          if ( subject.isInGroup(\"users\") && (\n           action.id == \"org.freedesktop.login1.reboot\" ||\n           action.id == \"org.freedesktop.login1.reboot-multiple-sessions\" ||\n           action.id == \"org.freedesktop.login1.power-off\" ||\n           action.id == \"org.freedesktop.login1.power-off-multiple-sessions\"\n          ))\n          { return polkit.Result.YES; }\n        })\n      '';\n    };\n    pam.services.swaylock = {\n      text = ''auth include login '';\n    };\n  };\n}"}
{"p":"modules/core/services.nix","c":"{ ... }:\n{\n  services = {\n    libinput.enable = true; # Input Handling\n    fstrim.enable = true; # SSD Optimizer\n    gvfs.enable = true; # For Mounting USB & More\n    openssh.enable = true; # Enable SSH\n    blueman.enable = true; # Bluetooth Support\n    tumbler.enable = true; # Image/video preview\n    gnome.gnome-keyring.enable = true;\n    upower.enable = true; # Power management (required for DMS battery monitoring)\n    smartd = {\n      enable = true;\n      autodetect = true;\n    };\n    pipewire = {\n      enable = true;\n      alsa.enable = true;\n      alsa.support32Bit = true;\n      pulse.enable = true;\n      wireplumber.enable = true; # Enable WirePlumber session manager\n    };\n  };\n}"}
{"p":"modules/core/steam.nix","c":"{ pkgs, ... }:\n{\n  programs = {\n    steam = {\n      enable = true;\n      remotePlay.openFirewall = true;\n      dedicatedServer.openFirewall = false;\n      extraCompatPackages = [ pkgs.proton-ge-bin ];\n      package = pkgs.steam.override {\n        extraPkgs =\n          pkgs: with pkgs; [\n            libusb1\n            udev\n            SDL2\n            xorg.libXcursor\n            xorg.libXi\n            xorg.libXinerama\n            xorg.libXScrnSaver\n            xorg.libXcomposite\n            xorg.libXdamage\n            xorg.libXrender\n            xorg.libXext\n            libkrb5\n            keyutils\n          ];\n      };\n    };\n  };\n  environment.systemPackages = with pkgs; [\n    mangohud\n  ];\n}"}
{"p":"modules/core/stylix.nix","c":"{\n  pkgs,\n  lib,\n  ...\n}: let\n  inherit (import ../../hosts/variables.nix) stylixImage stylixEnable;\nin\nlib.mkIf stylixEnable {\n  stylix = {\n    enable = true;\n    enableReleaseChecks = false;\n    image = stylixImage;\n    polarity = \"dark\";\n    opacity.terminal = 1.0;\n    cursor = {\n      package = pkgs.bibata-cursors;\n      name = \"Bibata-Modern-Ice\";\n      size = 24;\n    };\n    fonts = {\n      monospace = {\n        package = pkgs.nerd-fonts.jetbrains-mono;\n        name = \"JetBrains Mono\";\n      };\n      sansSerif = {\n        package = pkgs.montserrat;\n        name = \"Montserrat\";\n      };\n      serif = {\n        package = pkgs.montserrat;\n        name = \"Montserrat\";\n      };\n      sizes = {\n        applications = 12;\n        terminal = 15;\n        desktop = 11;\n        popups = 12;\n      };\n    };\n  };\n}"}
{"p":"modules/core/system.nix","c":"{ pkgs, ... }:\nlet\n  variables = import ../../hosts/variables.nix;\n  inherit (variables) consoleKeyMap timeZone;\nin\n{\n  nix = {\n    settings = {\n      download-buffer-size = 250000000;\n      auto-optimise-store = true;\n      experimental-features = [\n        \"nix-command\"\n        \"flakes\"\n      ];\n      substituters = [ \"https://hyprland.cachix.org\" ];\n      trusted-public-keys = [ \"hyprland.cachix.org-1:a7pgxzMz7+chwVL3/pzj6jIBMioiJM7ypFP8PwtkuGc=\" ];\n    };\n  };\n  time.timeZone = \"${timeZone}\";\n  i18n.defaultLocale = \"en_US.UTF-8\";\n  programs.nix-ld.enable = true;\n  programs.nix-ld.libraries = with pkgs; [\n    stdenv.cc.cc.lib\n    zlib\n    openssl\n    libGL\n  ];\n  console.keyMap = \"${consoleKeyMap}\";\n  system.stateVersion = \"25.05\";\n}"}
{"p":"modules/core/user.nix","c":"{\n  pkgs,\n  inputs,\n  username,\n  host,\n  profile,\n  ...\n}:\nlet\n  variables = import ../../hosts/variables.nix;\n  inherit (variables) gitUsername;\n  defaultShell = variables.defaultShell or \"zsh\";\n  shellPackage = if defaultShell == \"fish\" then pkgs.fish else pkgs.zsh;\nin\n{\n  imports = [ inputs.home-manager.nixosModules.home-manager ];\n  programs.fish.enable = true;\n  programs.zsh.enable = true;\n  users.groups.i2c = {};\n  home-manager = {\n    useUserPackages = true;\n    useGlobalPkgs = true;\n    backupFileExtension = \"backup\";\n    extraSpecialArgs = {\n      inherit\n        inputs\n        username\n        host\n        profile\n        ;\n    };\n    users.${username} = {\n      imports = [ ./../home ];\n      home = {\n        username = \"${username}\";\n        homeDirectory = \"/home/${username}\";\n        stateVersion = \"25.05\";\n      };\n    };\n  };\n  users.mutableUsers = true;\n  users.users.${username} = {\n    isNormalUser = true;\n    description = \"${gitUsername}\";\n    extraGroups = [\n      \"adbusers\"\n      \"docker\"\n      \"libvirtd\" # For VirtManager\n      \"lp\"\n      \"networkmanager\"\n      \"scanner\"\n      \"wheel\" # sudo access\n      \"vboxusers\" # For VirtualBox\n      \"i2c\"\n    ];\n    shell = shellPackage;\n    ignoreShellProgramCheck = true;\n  };\n  nix.settings.allowed-users = [ \"${username}\" ];\n}"}
{"p":"modules/home/appimage.nix","c":"{ pkgs, ... }:\n{\n  home.packages = [\n    (pkgs.writeShellScriptBin \"envision\" ''\n      ENVISION_CACHE=\"$HOME/.cache/appimages/envision.AppImage\"\n      mkdir -p \"$(dirname \"$ENVISION_CACHE\")\"\n      if [ ! -f \"$ENVISION_CACHE\" ] || [ $(find \"$ENVISION_CACHE\" -mtime +7) ]; then\n        echo \"üì¶ Downloading Envision AppImage...\"\n        curl -L \"https://gitlab.com/gabmus/envision/-/releases/permalink/latest/downloads/envision.AppImage\" \\\n          -o \"$ENVISION_CACHE\"\n        chmod +x \"$ENVISION_CACHE\"\n      fi\n      exec ${pkgs.appimage-run}/bin/appimage-run \"$ENVISION_CACHE\" \"$@\"\n    '')\n  ];\n}"}
{"p":"modules/home/default.nix","c":"{\n  lib,\n  ...\n}:\nlet\n  variables = import ../../hosts/variables.nix;\n  barChoice = variables.barChoice or \"noctalia\";\n  defaultShell = variables.defaultShell or \"zsh\";\nin\n{\n  imports = [\n    ./appimage.nix\n    ./environment.nix\n    ./fzf.nix\n    ./git.nix\n    ./gtk.nix\n    ./kitty.nix\n    ./lazygit.nix\n    ./niri\n    ./packages.nix\n    ./qt.nix\n    ./scripts\n    ./starship.nix\n    ./stylix.nix\n    ./thunar.nix\n    ./zed.nix\n    ./zoxide.nix\n  ]\n  ++ lib.optionals (defaultShell == \"zsh\") [ ./zsh.nix ]\n  ++ lib.optionals (barChoice == \"noctalia\") [ ./noctalia-shell ];\n}"}
{"p":"modules/home/environment.nix","c":"{ ... }:\n{\n  home.sessionVariables = {\n    BROWSER = \"xdg-open\";\n    EDITOR = \"zeditor\";\n    TERMINAL = \"kitty\";\n    NIXOS_OZONE_WL = \"1\";\n    MOZ_ENABLE_WAYLAND = \"1\";\n    ELECTRON_OZONE_PLATFORM_HINT = \"wayland\";\n    XDG_CURRENT_DESKTOP = \"niri\";\n    XDG_SESSION_DESKTOP = \"niri\";\n    XDG_SESSION_TYPE = \"wayland\";\n    GTK_USE_PORTAL = \"1\";\n    QT_QPA_PLATFORM = \"wayland\";\n    _JAVA_AWT_WM_NONREPARENTING = \"1\";\n    FONTCONFIG_FILE = \"/etc/fonts/fonts.conf\";\n  };\n}"}
{"p":"modules/home/fzf.nix","c":"{\n  config,\n  lib,\n  ...\n}: let\n  accent = \"#\" + config.lib.stylix.colors.base0D;\n  foreground = \"#\" + config.lib.stylix.colors.base05;\n  muted = \"#\" + config.lib.stylix.colors.base03;\nin {\n  programs.fzf = {\n    enable = true;\n    enableZshIntegration = true;\n    enableFishIntegration = true;\n    colors = lib.mkForce {\n      \"fg+\" = accent;\n      \"bg+\" = \"-1\";\n      \"fg\" = foreground;\n      \"bg\" = \"-1\";\n      \"prompt\" = muted;\n      \"pointer\" = accent;\n    };\n    defaultOptions = [\n      \"--margin=1\"\n      \"--layout=reverse\"\n      \"--border=none\"\n      \"--info='hidden'\"\n      \"--header=''\"\n      \"--prompt='--> '\"\n      \"-i\"\n      \"--no-bold\"\n      \"--bind='enter:execute(nvim {})'\"\n      \"--preview='bat --style=numbers --color=always --line-range :500 {}'\"\n      \"--preview-window=right:60%:wrap\"\n    ];\n  };\n}"}
{"p":"modules/home/git.nix","c":"{host, ...}: let\n  inherit (import ../../hosts/variables.nix) gitUsername gitEmail;\nin {\n  programs.git = {\n    enable = true;\n    settings = {\n      user = {\n        name = \"${gitUsername}\";\n        email = \"${gitEmail}\";\n      };\n      push.default = \"simple\"; # Match modern push behavior\n      credential.helper = \"cache --timeout=7200\";\n      init.defaultBranch = \"main\"; # Set default new branches to 'main'\n      log.decorate = \"full\"; # Show branch/tag info in git log\n      log.date = \"iso\"; # ISO 8601 date format\n      merge.conflictStyle = \"diff3\";\n      alias = {\n        br = \"branch --sort=-committerdate\";\n        co = \"checkout\";\n        df = \"diff\";\n        com = \"commit -a\";\n        gs = \"stash\";\n        gp = \"pull\";\n        lg = \"log --graph --pretty=format:'%Cred%h%Creset - %C(yellow)%d%Creset %s %C(green)(%cr)%C(bold blue) <%an>%Creset' --abbrev-commit\";\n        st = \"status\";\n      };\n    };\n  };\n}"}
{"p":"modules/home/gtk.nix","c":"{ pkgs, ... }:\n{\n  gtk = {\n    iconTheme = {\n      name = \"Tela-purple-dark\";\n      package = pkgs.tela-icon-theme;\n    };\n    gtk3.extraConfig = {\n      gtk-application-prefer-dark-theme = 1;\n    };\n    gtk4.extraConfig = {\n      gtk-application-prefer-dark-theme = 1;\n    };\n  };\n}"}
{"p":"modules/home/kitty.nix","c":"{ pkgs, host, ... }:\nlet\n  variables = import ../../hosts/variables.nix;\n  defaultShell = variables.defaultShell or \"zsh\";\n  shellPackage = if defaultShell == \"fish\" then pkgs.fish else pkgs.zsh;\nin\n{\n  programs.kitty = {\n    enable = true;\n    package = pkgs.kitty;\n    settings = {\n      shell = \"${shellPackage}/bin/${defaultShell}\";\n      font_size = 12;\n      wheel_scroll_min_lines = 1;\n      window_padding_width = 4;\n      confirm_os_window_close = 0;\n      scrollback_lines = 10000;\n      enable_audio_bell = false;\n      mouse_hide_wait = 60;\n      cursor_trail = 1;\n      tab_fade = 1;\n      active_tab_font_style = \"bold\";\n      inactive_tab_font_style = \"bold\";\n      tab_bar_edge = \"top\";\n      tab_bar_margin_width = 0;\n      tab_bar_style = \"powerline\";\n      enabled_layouts = \"splits\";\n    };\n    extraConfig = ''\n      map ctrl+shift+v        paste_from_selection\n      map shift+insert        paste_from_selection\n      map ctrl+shift+up        scroll_line_up\n      map ctrl+shift+down      scroll_line_down\n      map ctrl+shift+k         scroll_line_up\n      map ctrl+shift+j         scroll_line_down\n      map ctrl+shift+page_up   scroll_page_up\n      map ctrl+shift+page_down scroll_page_down\n      map ctrl+shift+home      scroll_home\n      map ctrl+shift+end       scroll_end\n      map ctrl+shift+h         show_scrollback\n      map alt+n               new_os_window\n      map alt+w               close_window\n      map ctrl+shift+enter    launch --location=hsplit\n      map ctrl+shift+s        launch --location=vsplit\n      map ctrl+shift+]        next_window\n      map ctrl+shift+[        previous_window\n      map ctrl+shift+f        move_window_forward\n      map ctrl+shift+b        move_window_backward\n      map ctrl+shift+`        move_window_to_top\n      map ctrl+shift+1        first_window\n      map ctrl+shift+2        second_window\n      map ctrl+shift+3        third_window\n      map ctrl+shift+4        fourth_window\n      map ctrl+shift+5        fifth_window\n      map ctrl+shift+6        sixth_window\n      map ctrl+shift+7        seventh_window\n      map ctrl+shift+8        eighth_window\n      map ctrl+shift+9        ninth_window # Tab management\n      map ctrl+shift+0        tenth_window\n      map ctrl+shift+right    next_tab\n      map ctrl+shift+left     previous_tab\n      map ctrl+shift+t        new_tab\n      map ctrl+shift+q        close_tab\n      map ctrl+shift+l        next_layout\n      map ctrl+shift+.        move_tab_forward\n      map ctrl+shift+,        move_tab_backward\n      map ctrl+shift+up      increase_font_size\n      map ctrl+shift+down    decrease_font_size\n      map ctrl+shift+backspace restore_font_size\n    '';\n  };\n}"}
{"p":"modules/home/lazygit.nix","c":"{ config, lib, ... }:\nlet\n  accent = \"#${config.lib.stylix.colors.base0D}\";\n  muted = \"#${config.lib.stylix.colors.base03}\";\nin {\n  programs.lazygit = {\n    enable = true;\n    settings = lib.mkForce {\n      disableStartupPopups = true;\n      notARepository = \"skip\";\n      promptToReturnFromSubprocess = false;\n      update.method = \"never\";\n      git = {\n        commit.signOff = true;\n        parseEmoji = true;\n      };\n      gui = {\n        theme = {\n          activeBorderColor = [ accent \"bold\" ];\n          inactiveBorderColor = [ muted ];\n        };\n        showListFooter = false;\n        showRandomTip = false;\n        showCommandLog = false;\n        showBottomLine = false;\n        nerdFontsVersion = \"3\";\n      };\n    };\n  };\n}"}
{"p":"modules/home/niri/default.nix","c":"{ ... }:\n{\n  imports = [\n    ./niri.nix\n  ];\n}"}
{"p":"modules/home/niri/keybinds.nix","c":"{\n  terminal,\n  browser,\n  hostKeybinds ? \"\",\n  ...\n}:\n''\n  binds {\n      // === Apps ===\n      Mod+Return { spawn \"${terminal}\"; }\n      Mod+B { spawn \"${browser}\"; }\n      Mod+E { spawn \"errands\"; }\n      Mod+Space { spawn \"noctalia-shell\" \"ipc\" \"call\" \"launcher\" \"toggle\"; }\n      Mod+Z { spawn \"zeditor\"; }\n      // === Deezer ===\n      XF86AudioRaiseVolume allow-when-locked=true { spawn \"playerctl\" \"--player=Deezer\" \"volume\" \"0.05+\"; }\n      XF86AudioLowerVolume allow-when-locked=true { spawn \"playerctl\" \"--player=Deezer\" \"volume\" \"0.05-\"; }\n      XF86AudioMute        allow-when-locked=true { spawn \"playerctl\" \"--player=Deezer\" \"play-pause\"; }\n      XF86AudioPlay        allow-when-locked=true { spawn \"playerctl\" \"--player=Deezer\" \"play-pause\"; }\n      XF86AudioNext        allow-when-locked=true { spawn \"playerctl\" \"--player=Deezer\" \"next\"; }\n      XF86AudioPrev        allow-when-locked=true { spawn \"playerctl\" \"--player=Deezer\" \"previous\"; }\n      Mod+WheelScrollDown cooldown-ms=50 { spawn \"playerctl\" \"--player=Deezer\" \"volume\" \"0.05-\"; }\n      Mod+WheelScrollUp   cooldown-ms=50 { spawn \"playerctl\" \"--player=Deezer\" \"volume\" \"0.05+\"; }\n      Mod+MouseMiddle     { spawn \"playerctl\" \"--player=Deezer\" \"play-pause\"; }\n      // === Desktop Brightness (Native) ===\n      // Works because Udev attached the driver automatically!\n      Mod+F1 { spawn \"swayosd-client\" \"--brightness\" \"lower\"; }\n      Mod+F2 { spawn \"swayosd-client\" \"--brightness\" \"raise\"; }\n      // === System & Window Management ===\n      Mod+S { screenshot; }\n      Mod+Q { close-window; }\n      Mod+Shift+Q { quit; }\n      Mod+L { spawn \"loginctl\" \"lock-session\"; }\n      Mod+Minus { set-column-width \"33.333%\"; }\n      Mod+Equal { set-column-width \"50%\"; }\n      Mod+BracketLeft { set-column-width \"66.667%\"; }\n      Mod+BracketRight { set-column-width \"100%\"; }\n      Mod+R { switch-preset-column-width; }\n      Mod+F { maximize-column; }\n      Mod+Shift+F { fullscreen-window; }\n      Mod+C { center-column; }\n      Mod+Left  { focus-column-left; }\n      Mod+Right { focus-column-right; }\n      Mod+Shift+Left  { move-column-left; }\n      Mod+Shift+Right { move-column-right; }\n      Mod+Down  { focus-workspace-down; }\n      Mod+Up    { focus-workspace-up; }\n      Mod+Shift+Down  { move-column-to-workspace-down; }\n      Mod+Shift+Up    { move-column-to-workspace-up; }\n      Mod+J     { focus-window-down; }\n      Mod+K     { focus-window-up; }\n      ${hostKeybinds}\n  }\n''"}
{"p":"modules/home/niri/layout.nix","c":"{ ... }:\n''\n  config-notification {\n      disable-failed\n  }\n  gestures {\n      hot-corners {\n          off\n      }\n  }\n  input {\n      keyboard {\n          xkb {\n          }\n          numlock\n      }\n      touchpad {\n          // Natural scrolling inverts scroll direction\n          // Up swipe scrolls down, down swipe scrolls up (natural direction)\n          natural-scroll\n      }\n      mouse {\n          accel-profile \"adaptive\"\n          accel-speed 1.0\n      }\n      trackpoint {\n      }\n      focus-follows-mouse\n      warp-mouse-to-focus\n  }\n  layout {\n      gaps 9\n      center-focused-column \"never\"\n      always-center-single-column\n      preset-column-widths {\n          proportion 0.33333\n          proportion 0.5\n          proportion 0.66667\n          proportion 1.0\n      }\n      default-column-width { proportion 0.5; }\n      border {\n          width 2\n          active-color \"#cba6f7\"\n          inactive-color \"#45475a\"\n          urgent-color \"#f5c2e7\"\n      }\n      focus-ring {\n          off\n          width 2\n          active-color   \"#808080\"\n          inactive-color \"#505050\"\n      }\n      shadow {\n          softness 30\n          spread 5\n          offset x=0 y=5\n          color \"#0007\"\n      }\n      struts {\n      }\n  }\n  /-layer-rule {\n      match namespace=\"^quickshell$\"\n      place-within-backdrop true\n  }\n  overview {\n      backdrop-color \"#1e1e2e\"\n      workspace-shadow {\n          softness 40\n          spread 10\n          offset x=0 y=10\n          color \"#00000050\"\n      }\n      zoom 0.5\n  }\n  animations {\n      workspace-switch {\n          spring damping-ratio=0.80 stiffness=523 epsilon=0.0001\n      }\n      window-open {\n          duration-ms 150\n          curve \"ease-out-expo\"\n      }\n      window-close {\n          duration-ms 150\n          curve \"ease-out-quad\"\n      }\n      horizontal-view-movement {\n          spring damping-ratio=0.85 stiffness=423 epsilon=0.0001\n      }\n      window-movement {\n          spring damping-ratio=0.75 stiffness=323 epsilon=0.0001\n      }\n      window-resize {\n          spring damping-ratio=0.85 stiffness=423 epsilon=0.0001\n      }\n      config-notification-open-close {\n          spring damping-ratio=0.65 stiffness=923 epsilon=0.001\n      }\n      screenshot-ui-open {\n          duration-ms 200\n          curve \"ease-out-quad\"\n      }\n      overview-open-close {\n          spring damping-ratio=0.85 stiffness=800 epsilon=0.0001\n      }\n  }\n''"}
{"p":"modules/home/niri/niri.nix","c":"{\n  host,\n  config,\n  pkgs,\n  lib,\n  ...\n}:\nlet\n  variables = import ../../../hosts/variables.nix;\n  inherit (variables)\n    browser\n    terminal\n    stylixImage\n    startupApps\n    monitorConfig\n    ;\n  barChoice = variables.barChoice or \"waybar\";\n  hostKeybindsPath = ./hosts/${host}/keybinds.nix;\n  hostKeybinds =\n    if builtins.pathExists hostKeybindsPath then import hostKeybindsPath { inherit host; } else \"\";\n  keybindsModule = import ./keybinds.nix {\n    inherit\n      host\n      terminal\n      browser\n      barChoice\n      hostKeybinds\n      config\n      ;\n  };\n  windowrulesModule = import ./windowrules.nix { inherit host; };\n  layoutModule = import ./layout.nix { };\n  workspacesModule = import ./workspaces.nix { };\n  startupModule = import ./startup.nix {\n    inherit\n      host\n      stylixImage\n      startupApps\n      barChoice\n      pkgs\n      ;\n  };\n  hostOutputsPath = ./hosts/${host}/outputs.nix;\n  hostOutputs =\n    if builtins.pathExists hostOutputsPath then\n      import hostOutputsPath { inherit host; }\n    else\n      monitorConfig;  # Use variable if no host file\n  hostWindowRulesPath = ./hosts/${host}/windowrules.nix;\n  hostWindowRules =\n    if builtins.pathExists hostWindowRulesPath then\n      import hostWindowRulesPath { inherit host; }\n    else\n      \"\";\n  baseConfig = ''\n    // Niri Configuration for ${host}\n    // Generated by NixOS configuration - BASE PART\n    ${hostOutputs}\n    ${workspacesModule}\n    ${keybindsModule}\n    ${windowrulesModule}\n    ${hostWindowRules}\n    ${startupModule}\n    environment {\n          XDG_CURRENT_DESKTOP \"niri\"\n          // --- Graphic & Toolkit Flags ---\n          GTK_USE_PORTAL \"1\"\n          MOZ_ENABLE_WAYLAND \"1\"\n          NIXOS_OZONE_WL \"1\"\n          ELECTRON_OZONE_PLATFORM_HINT \"wayland\"\n          QT_QPA_PLATFORM \"wayland\"\n          QT_QPA_PLATFORMTHEME \"gtk3\"\n          QT_QPA_PLATFORMTHEME_QT6 \"gtk3\"\n          TERMINAL \"${terminal}\"\n          XCURSOR_THEME \"Bibata-Modern-Ice\"\n          XCURSOR_SIZE \"24\"\n          // NVIDIA Gaming Optimizations\n          __GL_GSYNC_ALLOWED \"1\"\n          __GL_VRR_ALLOWED \"1\"\n          PROTON_ENABLE_NVAPI \"1\"\n          PROTON_HIDE_NVIDIA_GPU \"0\"\n          PROTON_ENABLE_NGX_UPDATER \"1\"\n    }\n    hotkey-overlay {\n        skip-at-startup\n    }\n    prefer-no-csd\n    screenshot-path \"~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png\"\n  '';\n  userConfig = ''\n    // Niri USER Configuration - Editable for theming\n    // This file can be modified without rebuilding\n    ${layoutModule}\n  '';\nin\n{\n  home.packages = with pkgs; [\n    niri\n    udiskie\n    xwayland-satellite\n    swww\n    grim\n    slurp\n    wl-clipboard\n    swappy\n  ];\n  xdg.configFile.\"niri/config-base.kdl\".text = baseConfig;\n  xdg.configFile.\"niri/config-user.kdl\".text = userConfig;\n  home.file.\".local/bin/niri-reload-theme\" = {\n    text = ''\n      cat ~/.config/niri/config-base.kdl ~/.config/niri/config-user.kdl > ~/.config/niri/config.kdl\n      niri msg reload-config\n      echo \"üé® Niri theme reloaded!\"\n    '';\n    executable = true;\n  };\n  home.activation.setupNiriConfig = lib.hm.dag.entryAfter [ \"writeBoundary\" ] ''\n    $DRY_RUN_CMD cat \"$HOME/.config/niri/config-base.kdl\" \"$HOME/.config/niri/config-user.kdl\" > \"$HOME/.config/niri/config.kdl\"\n  '';\n  systemd.user.targets.niri-session = {\n    Unit = {\n      Description = \"Niri compositor session\";\n      Documentation = \"man:systemd.special(7)\";\n      BindsTo = \"graphical-session.target\";\n      Wants = \"graphical-session-pre.target\";\n      After = \"graphical-session-pre.target\";\n    };\n  };\n  systemd.user.services.waybar-niri = lib.mkIf (barChoice == \"waybar\") {\n    Unit = {\n      Description = \"Waybar status bar (Niri session)\";\n      PartOf = \"graphical-session.target\";\n      After = \"graphical-session.target\";\n      ConditionEnvironment = \"XDG_CURRENT_DESKTOP=niri\";\n    };\n    Service = {\n      ExecStart = \"${pkgs.waybar}/bin/waybar\";\n      Restart = \"on-failure\";\n      RestartSec = \"1s\";\n    };\n    Install.WantedBy = [ \"graphical-session.target\" ];\n  };\n  systemd.user.services.dms-niri = lib.mkIf (barChoice == \"dms\") {\n    Unit = {\n      Description = \"DMS Desktop Management Shell (Niri session)\";\n      PartOf = \"graphical-session.target\";\n      After = \"graphical-session.target\";\n      ConditionEnvironment = \"XDG_CURRENT_DESKTOP=niri\";\n    };\n    Service = {\n      ExecStart = \"${config.home.homeDirectory}/.local/bin/dms run\";\n      Restart = \"on-failure\";\n      RestartSec = \"1s\";\n    };\n    Install.WantedBy = [ \"graphical-session.target\" ];\n  };\n  systemd.user.services.xwayland-satellite = {\n    Unit = {\n      Description = \"Xwayland outside Wayland\";\n      BindsTo = \"graphical-session.target\";\n      After = \"graphical-session.target\";\n    };\n    Service = {\n      Type = \"notify\";\n      NotifyAccess = \"all\";\n      ExecStart = \"${pkgs.xwayland-satellite}/bin/xwayland-satellite\";\n      StandardOutput = \"journal\";\n      Restart = \"on-failure\";\n    };\n    Install.WantedBy = [ \"graphical-session.target\" ];\n  };\n  home.file = {\n    \"Pictures/Wallpapers\" = {\n      source = ../../../wallpapers;\n      recursive = true;\n    };\n  };\n}"}
{"p":"modules/home/niri/startup.nix","c":"{\n  pkgs,\n  stylixImage,\n  barChoice,\n  ...\n}:\nlet\n  barStartupCommand =\n    if barChoice == \"noctalia\" then\n      ''spawn-at-startup \"noctalia-shell\"''\n    else\n      ''// ${barChoice} started via systemd service'';\n  polkitAgent = \"${pkgs.mate.mate-polkit}/libexec/polkit-mate-authentication-agent-1\";\n  updateEnv = pkgs.writeShellScript \"niri-env-update\" ''\n    export XDG_CURRENT_DESKTOP=niri\n    export XDG_SESSION_DESKTOP=niri\n    export XDG_SESSION_TYPE=wayland\n    ${pkgs.dbus}/bin/dbus-update-activation-environment --systemd \\\n      XDG_CURRENT_DESKTOP \\\n      XDG_SESSION_DESKTOP \\\n      XDG_SESSION_TYPE \\\n      WAYLAND_DISPLAY\n    ${pkgs.systemd}/bin/systemctl --user import-environment \\\n      XDG_CURRENT_DESKTOP \\\n      XDG_SESSION_DESKTOP \\\n      XDG_SESSION_TYPE \\\n      WAYLAND_DISPLAY\n  '';\nin\n''\n  // 1. Run the Environment Fix script immediately\n  spawn-at-startup \"${updateEnv}\"\n  // 2. Start Polkit (Password prompts)\n  spawn-at-startup \"${polkitAgent}\"\n  // 3. Start SwayOSD Server (The background worker)\n  spawn-at-startup \"swayosd-server\"\n  // 4. Desktop Components\n  spawn-at-startup \"bash\" \"-c\" \"wl-paste --watch cliphist store &\"\n  spawn-at-startup \"bash\" \"-c\" \"swww-daemon && sleep 1 && swww img '${stylixImage}'\"\n  ${barStartupCommand}\n  spawn-at-startup \"wal\" \"-R\"\n  // 5. Apps (Apps will trigger the portal restart automatically now)\n  spawn-at-startup \"vivaldi\"\n  spawn-at-startup \"corectrl\"\n  spawn-at-startup \"bash\" \"-c\" \"deezer-enhanced --ozone-platform=wayland & sleep 2; vesktop &\"\n''"}
{"p":"modules/home/niri/windowrules.nix","c":"{ ... }:\n''\n  // --- Global Look ---\n  window-rule {\n      geometry-corner-radius 12\n      clip-to-geometry true\n      draw-border-with-background false\n  }\n  // --- ERRANDS (Floating & Centered) ---\n  window-rule {\n      match app-id=r#\"^errands$|^io\\.github\\.mrvladus\\.List$\"#\n      open-floating true\n      default-column-width { proportion 0.4; }\n      default-window-height { proportion 0.6; }\n  }\n  // --- Workspace 1 Rules ---\n  // --- Vivaldi ---\n    window-rule {\n        match at-startup=true app-id=r#\"^vivaldi.*$\"#\n        open-on-workspace \"1\"\n        default-column-width { proportion 0.66667; }\n    }\n    // --- ZED EDITOR ---\n    window-rule {\n        match app-id=r#\"^dev\\.zed\\.Zed$\"#\n        default-column-width { proportion 0.33333; }\n    }\n    // --- Workspace 2 Rules ---\n    // Deezer (Left side intent)\n    window-rule {\n        match at-startup=true app-id=\"deezer-enhanced\"\n        open-on-workspace \"2\"\n        default-column-width { proportion 0.33333; }\n    }\n    // Vesktop (Right side intent)\n    window-rule {\n        match at-startup=true app-id=\"vesktop\"\n        open-on-workspace \"2\"\n        default-column-width { proportion 0.66667; }\n    }\n''"}
{"p":"modules/home/niri/workspaces.nix","c":"{ ... }:\n''\n  // Declare named workspaces so they exist at startup\n  // This allows open-on-workspace rules to work reliably\n  workspace \"1\" {\n      // You can pin this to a monitor if you have multiple\n      // open-on-output \"DP-1\"\n  }\n  workspace \"2\" {\n      // open-on-output \"DP-1\"\n  }\n''"}
{"p":"modules/home/noctalia-shell/default.nix","c":"{\n  lib,\n  pkgs,\n  inputs,\n  ...\n}:\nlet\n  variables = import ../../../hosts/variables.nix;\n  barChoice = variables.barChoice or \"waybar\";\n  enableNoctalia = barChoice == \"noctalia\";\nin\n{\n  imports = lib.optionals enableNoctalia [\n    inputs.noctalia.homeModules.default\n  ];\n  config = lib.mkIf enableNoctalia {\n    programs.waybar.enable = lib.mkForce false;\n    home.packages = [ inputs.noctalia.packages.${pkgs.system}.default ];\n    home.file.\".config/noctalia/settings.json.template\" = {\n      text = builtins.toJSON {\n        appLauncher = {\n          backgroundOpacity = 1;\n          enableClipboardHistory = false;\n          pinnedExecs = [ ];\n          position = \"center\";\n          sortByMostUsed = true;\n          terminalCommand = \"xterm -e\";\n          useApp2Unit = false;\n        };\n        audio = {\n          cavaFrameRate = 60;\n          mprisBlacklist = [ ];\n          preferredPlayer = \"\";\n          visualizerType = \"linear\";\n          volumeOverdrive = false;\n          volumeStep = 5;\n        };\n        bar = {\n          backgroundOpacity = 1;\n          density = \"default\";\n          floating = false;\n          marginHorizontal = 0.25;\n          marginVertical = 0.25;\n          monitors = [ ];\n          position = \"top\";\n          showCapsule = true;\n          widgets = {\n            center = [\n              {\n                customFont = \"\";\n                formatHorizontal = \"h:mm AP, MMM dd\";\n                formatVertical = \"HH mm - dd MM\";\n                id = \"Clock\";\n                useCustomFont = false;\n                usePrimaryColor = true;\n              }\n            ];\n            left = [\n              {\n                hideUnoccupied = false;\n                id = \"Workspace\";\n                labelMode = \"index\";\n              }\n              {\n                colorizeIcons = false;\n                hideMode = \"hidden\";\n                id = \"ActiveWindow\";\n                maxWidth = 145;\n                scrollingMode = \"hover\";\n                showIcon = true;\n                useFixedWidth = false;\n              }\n              {\n                hideMode = \"hidden\";\n                id = \"MediaMini\";\n                maxWidth = 145;\n                scrollingMode = \"hover\";\n                showAlbumArt = false;\n                showVisualizer = false;\n                useFixedWidth = false;\n                visualizerType = \"linear\";\n              }\n            ];\n            right = [\n              {\n                blacklist = [ ];\n                colorizeIcons = false;\n                id = \"Tray\";\n              }\n              {\n                id = \"SystemMonitor\";\n                showCpuTemp = true;\n                showCpuUsage = true;\n                showDiskUsage = false;\n                showMemoryAsPercent = false;\n                showMemoryUsage = true;\n                showNetworkStats = false;\n              }\n              {\n                hideWhenZero = true;\n                id = \"NotificationHistory\";\n                showUnreadBadge = true;\n              }\n              {\n                displayMode = \"onhover\";\n                id = \"Volume\";\n              }\n              {\n                customIconPath = \"/home/don/black-don-os/modules/home/fastfetch/blackdontrans.png\";\n                icon = \"noctalia\";\n                id = \"ControlCenter\";\n                useDistroLogo = false;\n              }\n            ];\n          };\n        };\n        battery = {\n          chargingMode = 0;\n        };\n        brightness = {\n          brightnessStep = 5;\n        };\n        colorSchemes = {\n          darkMode = true;\n          generateTemplatesForPredefined = true;\n          manualSunrise = \"06:30\";\n          manualSunset = \"18:30\";\n          matugenSchemeType = \"scheme-fruit-salad\";\n          predefinedScheme = \"Catppuccin\";\n          schedulingMode = \"off\";\n          useWallpaperColors = false;\n        };\n        controlCenter = {\n          cards = [\n            {\n              enabled = true;\n              id = \"profile-card\";\n            }\n            {\n              enabled = true;\n              id = \"shortcuts-card\";\n            }\n            {\n              enabled = true;\n              id = \"audio-card\";\n            }\n            {\n              enabled = true;\n              id = \"weather-card\";\n            }\n            {\n              enabled = true;\n              id = \"media-sysmon-card\";\n            }\n          ];\n          position = \"close_to_bar_button\";\n          shortcuts = {\n            left = [\n              {\n                id = \"WiFi\";\n              }\n              {\n                id = \"Bluetooth\";\n              }\n              {\n                id = \"ScreenRecorder\";\n              }\n              {\n                id = \"WallpaperSelector\";\n              }\n            ];\n            right = [\n              {\n                id = \"Notifications\";\n              }\n              {\n                id = \"PowerProfile\";\n              }\n              {\n                id = \"KeepAwake\";\n              }\n              {\n                id = \"NightLight\";\n              }\n            ];\n          };\n        };\n        dock = {\n          backgroundOpacity = 1;\n          colorizeIcons = true;\n          displayMode = \"exclusive\";\n          floatingRatio = 1;\n          monitors = [ \"DP-1\" ];\n          onlySameOutput = true;\n          pinnedApps = [ ];\n          size = 1;\n        };\n        general = {\n          animationDisabled = false;\n          animationSpeed = 1;\n          avatarImage = \"/home/don/black-don-os/modules/home/fastfetch/blackdontrans.png\";\n          compactLockScreen = false;\n          dimDesktop = true;\n          forceBlackScreenCorners = false;\n          language = \"en\";\n          lockOnSuspend = true;\n          radiusRatio = 0.5;\n          scaleRatio = 1;\n          screenRadiusRatio = 1;\n          showScreenCorners = false;\n        };\n        hooks = {\n          darkModeChange = \"\";\n          enabled = false;\n          wallpaperChange = \"\";\n        };\n        \"location\" = {\n          name = \"Local\";\n          showCalendarEvents = true;\n          showWeekNumberInCalendar = false;\n          use12hourFormat = false;\n          useFahrenheit = false;\n          weatherEnabled = true;\n        };\n        network = {\n          wifiEnabled = true;\n        };\n        nightLight = {\n          autoSchedule = true;\n          dayTemp = \"6500\";\n          enabled = false;\n          forced = false;\n          manualSunrise = \"06:30\";\n          manualSunset = \"18:30\";\n          nightTemp = \"4000\";\n        };\n        notifications = {\n          criticalUrgencyDuration = 15;\n          doNotDisturb = false;\n          \"location\" = \"top_right\";\n          lowUrgencyDuration = 3;\n          monitors = [ ];\n          normalUrgencyDuration = 8;\n          overlayLayer = true;\n          respectExpireTimeout = false;\n        };\n        osd = {\n          autoHideMs = 2000;\n          enabled = true;\n          \"location\" = \"top_right\";\n          monitors = [ ];\n          overlayLayer = true;\n        };\n        screenRecorder = {\n          audioCodec = \"opus\";\n          audioSource = \"default_output\";\n          colorRange = \"limited\";\n          directory = \"\";\n          frameRate = 60;\n          quality = \"very_high\";\n          showCursor = true;\n          videoCodec = \"h264\";\n          videoSource = \"portal\";\n        };\n        settingsVersion = 16;\n        setupCompleted = true;\n        templates = {\n          discord = false;\n          discord_armcord = false;\n          discord_dorion = false;\n          discord_equibop = false;\n          discord_lightcord = false;\n          discord_vesktop = false;\n          discord_webcord = false;\n          enableUserTemplates = false;\n          foot = false;\n          fuzzel = false;\n          ghostty = false;\n          gtk = false;\n          kcolorscheme = false;\n          kitty = false;\n          pywalfox = false;\n          qt = false;\n          vicinae = false;\n        };\n        ui = {\n          fontDefault = \"FiraCode Nerd Font\";\n          fontDefaultScale = 1;\n          fontFixed = \"DejaVu Sans Mono\";\n          fontFixedScale = 1;\n          panelsOverlayLayer = true;\n          tooltipsEnabled = true;\n        };\n        wallpaper = {\n          defaultWallpaper = \"\";\n          directory = \"\";\n          enableMultiMonitorDirectories = false;\n          enabled = true;\n          fillColor = \"#000000\";\n          fillMode = \"crop\";\n          monitors = [ ];\n          randomEnabled = false;\n          randomIntervalSec = 300;\n          setWallpaperOnAllMonitors = true;\n          transitionDuration = 1500;\n          transitionEdgeSmoothness = 0.05;\n          transitionType = \"random\";\n        };\n      };\n    };\n    home.activation.noctaliaSettingsInit = lib.hm.dag.entryAfter [ \"writeBoundary\" ] ''\n      SETTINGS_FILE=\"$HOME/.config/noctalia/settings.json\"\n      TEMPLATE_FILE=\"$HOME/.config/noctalia/settings.json.template\"\n      if [ ! -f \"$SETTINGS_FILE\" ] || [ -L \"$SETTINGS_FILE\" ]; then\n        $DRY_RUN_CMD rm -f \"$SETTINGS_FILE\"\n        $DRY_RUN_CMD cp \"$TEMPLATE_FILE\" \"$SETTINGS_FILE\"\n        $DRY_RUN_CMD chmod 644 \"$SETTINGS_FILE\"\n      fi\n    '';\n    home.activation.noctaliaWarning = lib.hm.dag.entryAfter [ \"noctaliaSettingsInit\" ] ''\n      $DRY_RUN_CMD echo \"\"\n      $DRY_RUN_CMD echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n      $DRY_RUN_CMD echo \"üåô Noctalia Shell is ENABLED\"\n      $DRY_RUN_CMD echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n      $DRY_RUN_CMD echo \"\"\n      $DRY_RUN_CMD echo \"‚ö†Ô∏è  Waybar has been automatically disabled\"\n      $DRY_RUN_CMD echo \"\"\n      $DRY_RUN_CMD echo \"üìù Configuration: ~/.config/noctalia/settings.json (GUI-editable)\"\n      $DRY_RUN_CMD echo \"üé® Settings synced from GUI (use ./sync-from-gui.py to update)\"\n      $DRY_RUN_CMD echo \"‚úèÔ∏è  All GUI changes persist across reboots\"\n      $DRY_RUN_CMD echo \"\"\n      $DRY_RUN_CMD echo \"üí° To update Nix template from GUI changes:\"\n      $DRY_RUN_CMD echo \"   cd modules/home/noctalia-shell && ./sync-from-gui.py\"\n      $DRY_RUN_CMD echo \"\"\n      $DRY_RUN_CMD echo \"üìö Docs: https://docs.noctalia.dev\"\n      $DRY_RUN_CMD echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n      $DRY_RUN_CMD echo \"\"\n    '';\n  };\n}"}
{"p":"modules/home/packages.nix","c":"{ pkgs, ... }:\n{\n  home.packages = with pkgs; [\n    vivaldi           # Browser\n    vesktop           # Discord\n    deezer-enhanced   # Music\n    zed-editor        # Code\n    networkmanagerapplet\n    ddcutil           # Monitor control\n    playerctl         # Media keys\n    swayosd           # Volume/brightness OSD\n    brightnessctl\n    xfce.thunar  # File manager\n    xfce.thunar-archive-plugin    # Right-click extract\n    xfce.thunar-volman            # Auto-mount USB\n    xfce.thunar-media-tags-plugin # Audio tags\n    ffmpegthumbnailer             # Video thumbnails\n    file-roller             # Archive GUI\n    ffmpegthumbnailer # Thumbnails\n    grim              # Screenshots\n    slurp             # Area selection\n    wl-clipboard      # Clipboard\n    swappy            # Edit screenshots\n    gemini-cli        # Gemini protocol\n    nvd               # Nix diffs\n    errands           # Todo app\n    github-cli        # Manage Github\n    hyfetch           # Gay flex\n  ];\n}"}
{"p":"modules/home/qt.nix","c":"_: {\n  qt = {\n    enable = true;\n  };\n}"}
{"p":"modules/home/starship.nix","c":"{\n  config,\n  lib,\n  ...\n}:\nlet\n  accent = \"#${config.lib.stylix.colors.base0D}\";\n  variables = import ../../hosts/variables.nix;\n  defaultShell = variables.defaultShell or \"zsh\";\nin\n{\n  programs.starship = {\n    enable = defaultShell != \"fish\";\n    settings = {\n      add_newline = false;\n      format = lib.concatStrings [\n        \"$nix_shell\"\n        \"$hostname\"\n        \"$directory\"\n        \"$git_branch\"\n        \"$git_state\"\n        \"$git_status\"\n        \"\\n\"\n        \"$character\"\n      ];\n      directory = {\n        style = accent;\n      };\n      character = {\n        success_symbol = \"[‚ùØ](${accent})\";\n        error_symbol = \"[‚ùØ](red)\";\n        vimcmd_symbol = \"[‚ùÆ](cyan)\";\n      };\n      nix_shell = {\n        format = \"[$symbol]($style) \";\n        symbol = \"üêö\";\n        style = \"\";\n      };\n      git_branch = {\n        symbol = \"Ôêò \";\n        style = \"bg:red fg:white bold\";\n        format = \"on [$symbol$branch]($style) \";\n      };\n      git_status = {\n        format = \"[[(*$conflicted$untracked$modified$staged$renamed$deleted)](218)($ahead_behind$stashed)]($style)\";\n        style = \"cyan\";\n        conflicted = \"\";\n        renamed = \"\";\n        deleted = \"\";\n        stashed = \"‚â°\";\n      };\n      git_state = {\n        format = \"([$state( $progress_current/$progress_total)]($style)) \";\n        style = \"bright-black\";\n      };\n    };\n  };\n}"}
{"p":"modules/home/stylix.nix","c":"{\n  host,\n  lib,\n  ...\n}:\nlet\n  inherit (import ../../hosts/variables.nix) stylixEnable;\nin\nlib.mkIf stylixEnable {\n  stylix.targets = {\n    waybar.enable = false;\n    rofi.enable = false;\n    hyprland.enable = false;\n    hyprlock.enable = false;\n    ghostty.enable = false;\n    qt.enable = true;\n  };\n}"}
{"p":"modules/home/thunar.nix","c":"{ ... }:\n{\n  xfconf.enable = true;  # Thunar needs xfconf for settings\n  gtk.enable = true;     # Thunar is GTK app\n  xdg.configFile.\"xfce4/xfconf/xfce-perchannel-xml/thunar.xml\".text = ''\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <channel name=\"thunar\" version=\"1.0\">\n      <property name=\"last-view\" type=\"string\" value=\"ThunarDetailsView\"/>\n      <property name=\"last-icon-view-zoom-level\" type=\"string\" value=\"THUNAR_ZOOM_LEVEL_NORMAL\"/>\n      <property name=\"last-details-view-zoom-level\" type=\"string\" value=\"THUNAR_ZOOM_LEVEL_NORMAL\"/>\n      <property name=\"last-window-width\" type=\"int\" value=\"1024\"/>\n      <property name=\"last-window-height\" type=\"int\" value=\"768\"/>\n      <property name=\"misc-single-click\" type=\"bool\" value=\"false\"/>\n      <property name=\"misc-new-tab-as-current\" type=\"bool\" value=\"true\"/>\n    </channel>\n  '';\n  xdg.configFile.\"Thunar/uca.xml\".text = ''\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <actions>\n      <action>\n        <icon>utilities-terminal</icon>\n        <name>Open Terminal Here</name>\n        <command>kitty --working-directory=%f</command>\n        <description>Open terminal in this folder</description>\n        <patterns>*</patterns>\n        <directories/>\n      </action>\n    </actions>\n  '';\n}"}
{"p":"modules/home/zed.nix","c":"{ ... }:\n{\n  xdg.configFile.\"zed/settings.json\".text = builtins.toJSON {\n    ui_font_size = 16;\n    buffer_font_size = 16;\n    theme = {\n      mode = \"system\";\n      light = \"One Light\";\n      dark = \"One Dark\";\n    };\n    autosave = \"on_focus_change\";\n    tab_size = 2;\n    soft_wrap = \"editor_width\";\n    terminal = {\n      font_family = \"JetBrains Mono\";\n      font_size = 15;\n    };\n    languages = {\n      Nix = {\n        language_servers = [\n          \"nixd\"\n          \"nil\"\n        ];\n        formatter = {\n          external = {\n            command = \"nixfmt\";\n            arguments = [ \"--stdin\" ];\n          };\n        };\n      };\n    };\n    lsp = {\n      nixd = {\n        settings = {\n          nixpkgs = {\n            expr = \"import <nixpkgs> { }\";\n          };\n          formatting = {\n            command = [ \"nixfmt\" ];\n          };\n        };\n      };\n    };\n  };\n}"}
{"p":"modules/home/zoxide.nix","c":"_: {\n  programs = {\n    zoxide = {\n      enable = true;\n      enableZshIntegration = true;\n      enableBashIntegration = true;\n      enableFishIntegration = true;\n      options = [\n        \"--cmd cd\"\n      ];\n    };\n  };\n}"}
{"p":"modules/home/zsh.nix","c":"{\n  ...\n}:\nlet\n  variables = import ../../hosts/variables.nix;\n  defaultShell = variables.defaultShell or \"zsh\";\nin\n{\n  programs.zsh = {\n    enable = true;\n    autosuggestion.enable = true;\n    syntaxHighlighting = {\n      enable = true;\n      highlighters = [\n        \"main\"\n        \"brackets\"\n        \"pattern\"\n        \"regexp\"\n        \"root\"\n        \"line\"\n      ];\n    };\n    historySubstringSearch.enable = true;\n    history = {\n      ignoreDups = true;\n      save = 10000;\n      size = 10000;\n    };\n    oh-my-zsh = {\n      enable = true;\n    };\n    plugins = [ ];\n    initContent = ''\n      ${\n        if defaultShell == \"fish\" then\n          ''\n            if [[ $(ps --no-header --pid=$PPID --format=comm) != \"fish\" && -z ''${BASH_EXECUTION_STRING} ]]; then\n              shopt -q login_shell && LOGIN_OPTION='--login' || LOGIN_OPTION=\"\"\n              exec fish $LOGIN_OPTION\n            fi\n          ''\n        else\n          \"\"\n      }\n      bindkey \"\\eh\" backward-word\n      bindkey \"\\ej\" down-line-or-history\n      bindkey \"\\ek\" up-line-or-history\n      bindkey \"\\el\" forward-word\n      if [ -f $HOME/.zshrc-personal ]; then\n        source $HOME/.zshrc-personal\n      fi\n    '';\n    shellAliases = {\n      c = \"clear\";\n      man = \"batman\";\n    };\n  };\n}"}
