{ ... }:
let
  variables = import ../../hosts/variables.nix;
  defaultShell = variables.defaultShell or "zsh";
in
{
  # Keep this to hook Starship into Zsh/Bash automatically
  programs.starship.enable = defaultShell != "fish";

  # Define the Template
  xdg.configFile."wal/templates/starship.toml".text = ''
    # Generated by NixOS (Layout) - Filled by Theme-Engine (Colors)
    add_newline = false

    [directory]
    style = "bold {syn_key}"
    format = "[$path]($style)[$read_only]($read_only_style) "

    [character]
    success_symbol = "[‚ùØ](bold {sem_green})"
    error_symbol = "[‚ùØ](bold {sem_red})"
    vimcmd_symbol = "[‚ùÆ]({sem_blue})"

    [nix_shell]
    format = "[$symbol]($style) "
    symbol = "üêö"
    style = "{ui_prim}"

    [git_branch]
    symbol = "Ôêò "
    # We use UI_SEC for the bubble background (was background-alt)
    format = "[ÓÇ∂]({ui_sec})on [$symbol$branch]($style)[ÓÇ¥]({ui_sec}) "
    style = "fg:{syn_fun} bg:{ui_sec}"

    [git_status]
    style = "{sem_yellow}"
    stashed = "‚â°"

    [git_state]
    style = "{fg_dim}"
    format = "([$state( $progress_current/$progress_total)]($style)) "
  '';
}
